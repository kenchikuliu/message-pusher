# 飞书群机器人配置指南

## 🤖 添加机器人步骤

### 1. 在飞书群中添加机器人
- 打开飞书群聊
- 点击群设置（右上角 `···`）
- 选择 "机器人" → "添加机器人"
- 选择 "自定义机器人"

### 2. 配置机器人信息
- **名称**: Claude Code 提醒
- **描述**: 任务完成自动提醒机器人
- **头像**: 可选择机器人头像

### 3. 安全设置（二选一）
#### 方案A：加签验证（推荐）
- 勾选 "加签验证"
- 复制显示的密钥

#### 方案B：IP白名单
- 选择 "IP白名单"
- 添加 IP：`127.0.0.1` （本地服务器）

### 4. 获取 Webhook URL
完成后会显示类似：
```
https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

## 💻 在消息推送系统中配置

### 1. 访问管理界面
- 打开：http://localhost:3000
- 登录：root / 123456

### 2. 配置飞书通道
- 进入 "推送设置"
- 点击 "添加通道"
- 选择通道类型：`lark` (飞书群机器人)
- 填写：
  ```
  通道名称: 飞书提醒
  Webhook URL: [粘贴刚才复制的URL]
  ```

### 3. 设为默认通道
- 勾选 "设为默认"
- 点击 "保存"

### 4. 测试通道
- 点击 "测试" 按钮
- 检查飞书群是否收到测试消息

## 🧪 测试推送功能

配置完成后，可以用以下方式测试：

### 命令行测试
```bash
python claude_notify.py "测试任务" "完成" "飞书推送配置成功"
```

### API 测试
```bash
curl -X POST "http://localhost:3000/push/root" \
  -H "Content-Type: application/json" \
  -d '{"title":"[TEST] 飞书测试","description":"配置成功","token":"claude_task_2025"}'
```

## 📱 使用效果

配置成功后，你将在飞书群收到：
- 📋 **任务标题**
- 📝 **详细描述**
- ⏰ **完成时间**
- 🔗 **消息详情链接**

## ❗ 故障排除

### 问题1：收不到消息
- 检查 Webhook URL 是否正确
- 确认机器人已成功添加到群中
- 验证安全设置（IP白名单或加签）

### 问题2：消息格式异常
- 检查通道类型是否选择 `lark`
- 确认 JSON 格式正确

### 问题3：推送频率限制
- 飞书机器人有频率限制
- 建议间隔至少1秒发送消息